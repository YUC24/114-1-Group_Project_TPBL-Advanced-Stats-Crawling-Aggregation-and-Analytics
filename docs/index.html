<!DOCTYPE html>
<html lang="zh-Hant">

<head>
  <meta charset="UTF-8" />
  <title>TPBL é€²éšæ•¸æ“šåˆ†æ</title>
  <link rel="stylesheet" href="style.css" />
</head>

<body>

  <header>
    <h1>TPBL é€²éšæ•¸æ“šåˆ†æ Dashboard</h1>
    <nav class="tabs">
      <button class="tab-button active" data-target="teams-section">çƒéšŠè³‡è¨Š</button>
      <button class="tab-button" data-target="players-section">çƒå“¡è³‡è¨Š</button>
      <button class="tab-button" data-target="schedule-section">è³½ç¨‹è³‡è¨Š</button>
    </nav>
  </header>

  <!-- ğŸ”½ æ–°å¢é€™ä¸€æ•´æ®µ ğŸ”½ -->
  <section id="games-section">
    <h2>æ¯”è³½æ•¸æ“š</h2>

    <div id="filters">
      <label>
        æ—¥æœŸå¾ï¼š
        <input type="date" id="dateFrom">
      </label>

      <label>
        åˆ°ï¼š
        <input type="date" id="dateTo">
      </label>

      <button id="clearDate">æ¸…é™¤æ—¥æœŸ</button>
    </div>

    <table id="gameTable">
      <thead>
        <tr>
          <!-- data-type æ±ºå®šé€™ä¸€æ¬„å¯ä»¥æ’åºï¼Œä»¥åŠç”¨ä»€éº¼å‹æ…‹æ’åº -->
          <th data-type="date">æ—¥æœŸ â–²â–¼</th>
          <th>å°æˆ°</th>
          <th data-type="number">å¾—åˆ† â–²â–¼</th>
          <th data-type="number">å¤±åˆ† â–²â–¼</th>
          <th data-type="number">TS% â–²â–¼</th>
        </tr>
      </thead>
      <tbody>
        </tr>
        <!-- ä¹‹å¾Œå¯ä»¥æ”¹æˆ main.js è‡ªå‹•ç”Ÿ -->
      </tbody>
    </table>
  </section>
  <!-- ğŸ”¼ æ–°å¢åˆ°é€™è£¡ ğŸ”¼ -->

  <main>
    <!-- çƒéšŠè³‡è¨Š -->
    <section id="teams-section" class="tab-section active">
      <h2>çƒéšŠé€²éšæ•¸æ“šï¼ˆTeam Advanced Statsï¼‰</h2>
      <p class="section-desc">é¡¯ç¤ºå„çƒéšŠçš„ eFG%ã€TS%ã€OffRtgã€DefRtg ç­‰æŒ‡æ¨™ã€‚</p>
      <table id="team-table">
        <thead>
          <tr>
            <th>çƒéšŠ</th>
            <th>eFG%</th>
            <th>TS%</th>
            <th>OffRtg</th>
            <th>DefRtg</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </section>

    <!-- çƒå“¡è³‡è¨Š -->
    <section id="players-section" class="tab-section">
      <h2>çƒå“¡é€²éšæ•¸æ“šï¼ˆPlayer Advanced Statsï¼‰</h2>
      <p class="section-desc">é¡¯ç¤ºçƒå“¡çš„å¾—åˆ†ã€TS%ã€eFG%ã€ä½¿ç”¨ç‡ç­‰æŒ‡æ¨™ã€‚</p>
      <table id="player-table">
        <thead>
          <tr>
            <th>çƒå“¡</th>
            <th>çƒéšŠ</th>
            <th>PTS</th>
            <th>TS%</th>
            <th>eFG%</th>
            <th>USG_share</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </section>

    <!-- è³½ç¨‹è³‡è¨Š -->
    <!DOCTYPE html>
    <html lang="zh-Hant">

    <head>
      <meta charset="UTF-8" />
      <title>TPBL è³½ç¨‹æŸ¥è©¢</title>
      <style>
        body {
          font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
            sans-serif;
          margin: 20px;
        }

        h1 {
          margin-bottom: 16px;
        }

        table {
          border-collapse: collapse;
          width: 100%;
          max-width: 1200px;
        }

        th,
        td {
          border: 1px solid #ccc;
          padding: 6px 8px;
          text-align: center;
          font-size: 14px;
        }

        th {
          background: #f2f2f2;
        }

        tbody tr:nth-child(even) {
          background: #fafafa;
        }
      </style>
    </head>

    <body>
      <h1>TPBL è³½ç¨‹</h1>

      <!-- ä¹‹å¾Œå¦‚æœè¦åŠ ç¯©é¸å¯ä»¥æ”¾åœ¨é€™è£¡ -->
      <!-- <div>ç¯©é¸å€å¡Š...</div> -->

      <table>
        <thead>
          <tr>
            <th>æ—¥æœŸ</th>
            <th>æ™‚é–“</th>
            <th>æ˜ŸæœŸ</th>
            <th>ä¸»éšŠ</th>
            <th>å®¢éšŠ</th>
            <th>å ´é¤¨</th>
            <th>è³½äº‹ä»£ç¢¼</th>
            <th>ç‹€æ…‹</th>
            <th>è½‰æ’­é€£çµ</th>
          </tr>
        </thead>
        <tbody id="games-body">
          <!-- JS æœƒæŠŠæ¯ä¸€å ´æ¯”è³½æ’åœ¨é€™è£¡ -->
        </tbody>
      </table>

      <script>
        // è®€å– data/games.json ä¸¦å¡é€²è¡¨æ ¼
        async function loadGames() {
          try {
            const res = await fetch('data/games.json');
            if (!res.ok) {
              throw new Error('HTTP error ' + res.status);
            }
            const games = await res.json();

            const tbody = document.getElementById('games-body');

            games.forEach(game => {
              const tr = document.createElement('tr');

              // æ—¥æœŸ
              const tdDate = document.createElement('td');
              tdDate.textContent = game.date || '';
              tr.appendChild(tdDate);

              // æ™‚é–“
              const tdTime = document.createElement('td');
              tdTime.textContent = game.time || '';
              tr.appendChild(tdTime);

              // æ˜ŸæœŸ
              const tdDow = document.createElement('td');
              tdDow.textContent = game.day_of_week || '';
              tr.appendChild(tdDow);

              // ä¸»éšŠ
              const tdHome = document.createElement('td');
              tdHome.textContent = game.home_team_name || '';
              tr.appendChild(tdHome);

              // å®¢éšŠ
              const tdAway = document.createElement('td');
              tdAway.textContent = game.away_team_name || '';
              tr.appendChild(tdAway);

              // å ´é¤¨
              const tdVenue = document.createElement('td');
              tdVenue.textContent = game.venue || '';
              tr.appendChild(tdVenue);

              // è³½äº‹ä»£ç¢¼ï¼ˆcodeï¼‰
              const tdCode = document.createElement('td');
              tdCode.textContent = game.code || '';
              tr.appendChild(tdCode);

              // ç‹€æ…‹
              const tdStatus = document.createElement('td');
              tdStatus.textContent = game.status || '';
              tr.appendChild(tdStatus);

              // è½‰æ’­ / recap é€£çµ
              const tdLink = document.createElement('td');
              const links = [];

              if (game.live_stream_url) {
                const aLive = document.createElement('a');
                aLive.href = game.live_stream_url;
                aLive.target = '_blank';
                aLive.textContent = 'ç›´æ’­';
                links.push(aLive);
              }

              if (game.recap_url) {
                const aRecap = document.createElement('a');
                aRecap.href = game.recap_url;
                aRecap.target = '_blank';
                aRecap.textContent = 'ç²¾è¯';
                links.push(aRecap);
              }

              if (links.length === 0) {
                tdLink.textContent = '-';
              } else {
                // ç”¨ç©ºæ ¼åˆ†éš”å¤šå€‹é€£çµ
                links.forEach((el, idx) => {
                  if (idx > 0) tdLink.appendChild(document.createTextNode(' '));
                  tdLink.appendChild(el);
                });
              }

              tr.appendChild(tdLink);

              tbody.appendChild(tr);
            });
          } catch (err) {
            console.error('è¼‰å…¥ games.json å¤±æ•—ï¼š', err);
            const tbody = document.getElementById('games-body');
            const tr = document.createElement('tr');
            const td = document.createElement('td');
            td.colSpan = 9;
            td.textContent = 'è¼‰å…¥è³½ç¨‹è³‡æ–™å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦ã€‚';
            tr.appendChild(td);
            tbody.appendChild(tr);
          }
        }

        loadGames();

      </script>
    </body>

    </html>


    <footer>
      <p>è³‡æ–™ä¾†æºï¼šTPBL å®˜ç¶²çˆ¬èŸ²æ•´ç† Â· æœ¬é é¢åƒ…ä¾›èª²ç¨‹å°ˆæ¡ˆä½¿ç”¨</p>
    </footer>

    <script src="main.js"></script>

    <!-- æ”¾åœ¨æœ€ä¸‹é¢çš„æ—¥æœŸç¯©é¸ï¼‹æ’åºç¨‹å¼ -->
    <script>
      document.addEventListener('DOMContentLoaded', () => {
        const table = document.getElementById('gameTable');
        if (!table) return; // ä¿éšªä¸€ä¸‹

        const tbody = table.querySelector('tbody');
        const allRows = Array.from(tbody.querySelectorAll('tr')); // æ‰€æœ‰åˆ—

        const dateFromInput = document.getElementById('dateFrom');
        const dateToInput = document.getElementById('dateTo');
        const clearBtn = document.getElementById('clearDate');

        // ========= â‘  æ—¥æœŸç¯©é¸ =========
        function applyDateFilter() {
          const from = dateFromInput.value; // e.g. "2024-11-01" or ""
          const to = dateToInput.value;

          allRows.forEach(row => {
            const rowDate = row.getAttribute('data-date'); // åŒæ¨£æ˜¯ YYYY-MM-DD
            let visible = true;

            if (from && rowDate < from) {
              visible = false;
            }
            if (to && rowDate > to) {
              visible = false;
            }

            row.style.display = visible ? '' : 'none';
          });
        }

        dateFromInput.addEventListener('change', applyDateFilter);
        dateToInput.addEventListener('change', applyDateFilter);
        clearBtn.addEventListener('click', () => {
          dateFromInput.value = '';
          dateToInput.value = '';
          applyDateFilter();
        });

        // ========= â‘¡ é»è¡¨é ­æ’åº =========
        let currentSortCol = null;
        let currentSortAsc = true;

        const headers = Array.from(table.querySelectorAll('thead th'));

        headers.forEach((th, colIndex) => {
          const type = th.dataset.type; // "number" æˆ– "date"ï¼Œå¦‚æœæ²’è¨­å°±ä¸æ’åº
          if (!type) return;

          th.style.cursor = 'pointer'; // æ»‘é¼ è®Šæ‰‹æŒ‡

          th.addEventListener('click', () => {
            // å¦‚æœé»åŒä¸€æ¬„ï¼Œåè½‰æ’åºæ–¹å‘ï¼›å¦å‰‡æ”¹æˆå‡å†ª
            if (currentSortCol === colIndex) {
              currentSortAsc = !currentSortAsc;
            } else {
              currentSortCol = colIndex;
              currentSortAsc = true;
            }

            // æŠŠæ‰€æœ‰åˆ—æ‹¿å‡ºä¾†æ’åºï¼ˆå³ä½¿æœ‰çš„åˆ—ç›®å‰è¢«éš±è—ï¼Œæ²’é—œä¿‚ï¼‰
            const rowsToSort = Array.from(allRows);

            rowsToSort.sort((a, b) => {
              let aVal, bVal;

              if (type === 'number') {
                aVal = parseFloat(a.children[colIndex].innerText) || 0;
                bVal = parseFloat(b.children[colIndex].innerText) || 0;
              } else if (type === 'date') {
                // é€™è£¡ç›´æ¥ç”¨ data-date ä¾†æ¯”å°ï¼Œæ¯” innerText å®‰å…¨
                aVal = a.getAttribute('data-date');
                bVal = b.getAttribute('data-date');
              } else {
                aVal = a.children[colIndex].innerText;
                bVal = b.children[colIndex].innerText;
              }

              if (aVal < bVal) return currentSortAsc ? -1 : 1;
              if (aVal > bVal) return currentSortAsc ? 1 : -1;
              return 0;
            });

            // æ’å®Œé‡æ–° append å› tbodyï¼ˆDOM æœƒä¾æ–°é †åºé¡¯ç¤ºï¼‰
            rowsToSort.forEach(row => tbody.appendChild(row));

            // æ›´æ–°ç®­é ­æ–‡å­—ï¼ˆç°¡å–®ç‰ˆï¼‰
            headers.forEach(h => {
              if (!h.dataset.type) return;
              h.textContent = h.textContent.replace(/ â–²â–¼| â–²| â–¼/g, '');
              if (h === th) {
                h.textContent += currentSortAsc ? ' â–²' : ' â–¼';
              } else {
                h.textContent += ' â–²â–¼';
              }
            });
          });
        });
      });
    </script>

</body>

</html>